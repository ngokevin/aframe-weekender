<!DOCTYPE html>
<html>
  <head>
    <title>A-Frame Weekender</title>
    <script src="https://unpkg.com/vue@2.5.17/dist/vue.js"></script>
    <script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidmerfield/randomColor/randomColor.js"></script>
    <style>
      html,
      body {
        background: #333;
        height: 100%;
        margin: 0;
        overflow-y: hidden;
        padding: 0;
      }
      ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }
      #tweetColumns {
        display: flex;
        overflow: auto;
        width: 2650px;
      }
      .tweetListContainer {
        align-items: center;
        display: flex;
        flex-direction: column;
        margin: 0;
        padding: 5px;
        height: 800px;
        width: 320px;
      }
      .tweetListHeader {
        color: #FAFAFA;
        font-family: monospace;
        text-transform: uppercase;
      }
      .tweetList {
        overflow: auto;
        width: 100%;
      }
      .tweet {
        border-bottom: 1px solid #CCC;
        display: none;
        padding-bottom: 15px;
      }
      .moveActions {
        display: flex;
        height: 32px;
        font-family: monospace;
        justify-content: center;
        text-transform: uppercase;
        width: 100%;
      }
      .moveAction {
        color: #FAFAFA;
        cursor: pointer;
        overflow: auto;
        padding: 10px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <ul id="tweetColumns">
        <li class="tweetListContainer" v-for="listName in listNames" :style="{backgroundColor: colors[listName]}">
          <h2 class="tweetListHeader">{{ listName }}</h2>
          <ul class="tweetList">
            <li class="tweet" v-for="(tweet, i) in lists[listName]" :data-id="tweet.id" :key="tweet.id">
              <span class="tweetContents"></span>
              <ul class="moveActions">
                <li class="moveAction" v-for="toListName in listNames" :style="{backgroundColor: colors[toListName]}" v-on:click="move(i, listName, toListName)">
                  {{ toListName.substring(0, 3) }}
                <li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </div>

    <script>
      // Initialize data.
      const data = {
        colors: {},
        lists: {},
        listNames: [
          'unassigned', 'featured', 'projects', 'components', 'articles', 'events', 'misc', 'discarded'
        ]
      };
      data.listNames.forEach(listName => {
        data.colors[listName] = randomColor({luminosity: 'dark'});
        data.lists[listName] = [];
      });

      // Create Vue.
      const app = new Vue({
        el: '#app',
        data: data,
        methods: {
          move: function (index, fromList, toList) {
            // Move Tweet from one list to another.
            const tweet = this.lists[fromList][index];
            this.$delete(this.lists[fromList], index);
            this.lists[toList].push(tweet);

            // Load in single Tweet.
            setTimeout(() => {
              twttr.widgets.createTweet(
                tweet.id,
                document.querySelector(`[data-id="${tweet.id}"] .tweetContents`)
              ).then(() => {
                document.querySelector(`[data-id="${tweet.id}"]`).style.display = 'block';
              });
            }, 100);
          }
        }
      })

      // Fetch Tweets.
      const xhr = new XMLHttpRequest();
      const hrefRegex = /href=".*?"/g;
      xhr.open('GET', 'tweets.json');
      xhr.addEventListener('load', function () {
        // Push to unassigned list.
        let tweets = JSON.parse(this.responseText);
        for (let i = 0; i < tweets.length; i++) {
          app.lists.unassigned.push(tweets[i]);
        }

        // Load in Tweets.
        setTimeout(() => {
          let tweets = document.querySelectorAll(`[data-id]`);
          tweets.forEach(tweet => {
            twttr.widgets.createTweet(
              tweet.dataset.id,
              tweet.querySelector('.tweetContents')
            ).then(() => {
              tweet.style.display = 'block';
            });
          });
        }, 100);
      });
      xhr.send();
    </script>
  </body>
</html>
